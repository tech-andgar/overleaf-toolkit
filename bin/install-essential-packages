#!/usr/bin/env bash

set -euo pipefail

ESSENTIAL_PACKAGES=(
    "titlesec"
    "enumitem"
    "fontawesome5"
)

echo "Updating tlmgr..."
docker exec sharelatex tlmgr update --self

echo "Installing essential packages..."
for package in "${ESSENTIAL_PACKAGES[@]}"; do
    echo "Installing ${package}..."
    docker exec sharelatex tlmgr install "${package}"
done

docker exec sharelatex tlmgr path add

CURRENT_VERSION=$(cat config/version)
NEW_VERSION="${CURRENT_VERSION}-with-essential-packages"

echo "Committing changes to new image with tag '${NEW_VERSION}'..."
docker commit sharelatex "sharelatex/sharelatex:${NEW_VERSION}"

echo "Updating config/version to '${NEW_VERSION}'..."
echo "${NEW_VERSION}" > config/version

echo "Restarting Overleaf..."
./bin/up

echo "Done!"
